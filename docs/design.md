# 产品设计文档 (PDD): LIFE.d MONITOR

## 1. 产品概述

本项目旨在将一个生命时间监视器从单一的数据仪表盘，升华为一个具有哲学思"双联画"式（Diptych）交互艺术品。它通过提供两种完全对立又互补的视角——"回望"与"展望"——来完整地叙述"从何处来"与"到何处去"的事，引导用户在过去与未来之间进行深刻的自我审视。

## 2. 核心功能

### 2.1. 双重视角系统 (Dual Perspective System)

系统核心是两种可切换的视角模式：`[ELAPSED]` 和 `[REMAINING]`。

*   **视角一：已逝 [ELAPSED]**
    *   **锚点 (Anchor):** `BORN` (诞生日期)。
    *   **核心指标 (Metric):** `ELAPSED` (已流逝的时间)。
    *   **叙事 (Narrative):** "我从何处来？"—— 衡量已经历的生命旅程。
    *   **UI 表现:** 进度条从左至右填充，表示已完成的百分比。

*   **视角二：剩余 [REMAINING]**
    *   **锚点 (Anchor):** `EOL` (End of Life / 预设的生命终点)。
    *   **核心指标 (Metric):** `REMAINING` (剩余时间)。
    *   **叙事 (Narrative):** "我将到何处去？"—— 衡量通往终点的剩余时间。
    *   **UI 表现:** 进度条从右至左填充（或左侧显示为空），表示剩余的百分比。

### 2.2. 数据模型与计算

*   **输入数据 (Input Data):**
    *   `birthDate` (String): 用户的出生日期，格式 `YYYY/MM/DD`。
    *   `lifeExpectancy` (Number): 用户的预期寿命（以年为单位），例如 `80`。

*   **计算数据 (Calculated Data):**
    *   `eolDate` (Date): 生命终点，计算方式为 `birthDate + lifeExpectancy`。
    *   `now` (Date): 当前时间。
    *   `elapsed` (Duration): 已用时间，计算方式为 `now - birthDate`。
    *   `remaining` (Duration): 剩余时间，计算方式为 `eolDate - now`。
    *   **校验:** `elapsed + remaining` 必须恒等于 `lifeExpectancy`。

### 2.3. 命令行界面 (CLI) 规格

界面严格遵循 `idea.md` 中提供的 ASCII 艺术风格，以纯文本字符渲染。

#### 2.3.1. 整体布局结构 (Overall Layout Structure)

CLI 界面采用一个固定的、多区域的垂直布局，所有内容都被包裹在一个 78 字符宽的容器内。

*   **页眉 (Header):** 占据顶行。负责显示应用的核心状态信息。
*   **主体 (Body):** 占据中间的核心区域。此区域被一条分隔线 (`-----------------`) 分为两个子区域：
    *   **上半部分:** 用于显示当前的日期和 ASCII 艺术风格的数字时钟。
    *   **下半部分:** 动态展示从年到秒的各级时间单位的进度条。
*   **页脚 (Footer):** 占据底行。提供交互提示。

这种结构确保了信息层次的清晰性和视觉上的稳定性。

#### 2.3.2. 界面组件详解 (UI Component Details)

组件的排列遵循从上到下的视觉顺序。

*   **A. 整体容器 (Container)**
    *   **尺寸:** 宽度固定为 78 个字符。
    *   **边框:** 使用 `+`, `-`, `|`, `=` 字符构建。
    *   **布局:** 所有内部元素的位置和间距必须严格按照 `idea.md` 中的 ASCII 艺术原型进行渲染，确保像素级（字符级）的精确对应。

*   **B. 头部信息 (`Header`)**
    *   **格式:** `LIFE.d MONITOR :: [ANCHOR] :: [TIME_METRIC]`
    *   **`[ELAPSED]` 模式下:** `LIFE.d MONITOR :: BORN 1988/07/23 :: ELAPSED: 35y 11m 21d ...`
    *   **`[REMAINING]` 模式下:** `LIFE.d MONITOR :: EOL 2068/07/23 :: REMAINING: 44y 0m 8d ...`

*   **C. 日期与时钟显示 (Date & Clock Display)**
    *   **位置:** 位于主体区域的上半部分，在头部信息和进度条之间。
    *   **内容:**
        *   **日期行:** 居中显示当前日期和星期，格式为 `YYYY / MM / DD | DAYOFWEEK` (例如: `2024 / 07 / 14 | SATURDAY`)。
        *   **ASCII 艺术时钟:** 在日期行下方，使用 `▓` 字符以大号点阵或七段显示器的风格，艺术化地渲染当前时间。这是一个纯粹的视觉元素，旨在营造氛围，而非精确读时。

*   **D. 进度条 (`Progress Bars`)**
    *   **位置:** 位于主体区域的下半部分。
    *   **字符集:**
        *   已流逝/已完成部分: `▓`
        *   当前单位的精确位置: `█`
        *   剩余/未开始部分: `░`
        *   `SECOND` 进度条轨迹: `>` 和 `<`
    *   **`[ELAPSED]` 模式:**
        *   `HOUR[18/24] HR | |▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓██░░░░░░░░░░░░░░░░| 75%`
        *   百分比计算: `(current_value / total_value) * 100`
    *   **`[REMAINING]` 模式:**
        *   `HOUR[18/24] HR | |░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░░██▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓| 25%`
        *   百分比计算: `((total_value - current_value) / total_value) * 100`
        *   `SECOND` 进度条的箭头方向反转: `█<=================================================<`

*   **E. 视角切换指示器 (`Perspective Switcher`)**
    *   **位置:** 界面右下角。
    *   **格式:** `> PERSPECTIVE :: [ MODE ]`
    *   **示例:** `> PERSPECTIVE :: [ ELAPSED ]`

#### 2.3.3. ASCII 艺术原型 (ASCII Art Prototypes)

##### A. 主监控界面 (Main Monitor Screen)

此原型展示了 `[ELAPSED]` 视角下的完整布局。页脚处集成了交互的快捷键提示。

```
+------------------------------------------------------------------------------+
| LIFE.d MONITOR :: BORN 1988/07/23 :: ELAPSED: 35y 11m 21d 18:31:52.891         |
|==============================================================================|
|                                                                              |
|                     2024 / 07 / 14 | SATURDAY                                 |
|                                                                              |
|   ▓▓▓    ▓▓▓             ▓▓▓   ▓▓▓              ▓▓▓   ▓▓▓▓▓                  |
|   ▓▓    ▓   ▓     ▓         ▓  ▓▓        ▓     ▓   ▓  ▓                      |
|   ▓▓▓    ▓▓▓             ▓▓   ▓▓▓              ▓▓▓    ▓▓▓                    |
|    ▓    ▓   ▓     ▓         ▓   ▓        ▓     ▓   ▓      ▓                   |
|   ▓▓▓    ▓▓▓             ▓▓▓   ▓▓▓              ▓   ▓  ▓▓▓                    |
|                                                                              |
|------------------------------------------------------------------------------|
|                                                                              |
|   HOUR[18/24] HR  | |▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓██░░░░░░░░░░░░░░░░| 75% |
| MINUTE[31/60] MIN | |▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█░░░░░░░░░░░░░░░░░░░░░░| 52% |
| SECOND[52/60] SEC | >================================================>█          | 87% |
|------------------------------------------------------------------------------|
|    DAY[21/31] DAY | |▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓██░░░░░░░░░░░░░░░░░░░░░░░░| 68% |
|  MONTH[11/12] MTH | |▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█░░░░░░░░░░| 92% |
|   LIFE[35/80] YRS  | |▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█░░░░░░░░░░░░░░░░░░░| 44% |
|                                                                              |
| [E]dit | [S]witch              > PERSPECTIVE :: [ ELAPSED ]                 |
+------------------------------------------------------------------------------+
```

##### B. 数据输入/修改浮窗 (Setup / Edit Overlay)

此原型展示了当用户需要输入数据时，在主监控界面之上弹出的浮动窗口。

```
+------------------------------------------------------------------------------+
| LIFE.d MONITOR :: BORN 1988/07/23 :: ELAPSED: 35y 11m 21d 18:31:52.891         |
|==============================================================================|
|                                                                              |
|                     2024 / 07 / 14 | SATURDAY                                 |
|                                                                              |
|   ▓▓▓    ▓▓▓             ▓▓▓   ▓▓▓              ▓▓▓   ▓▓▓▓▓                  |
|   ▓▓    ▓   ▓     ▓      +----------------------------------+ ▓   ▓  ▓        |
|   ▓▓▓    ▓▓▓             |          SETUP / EDIT          |    ▓▓▓           |
|    ▓    ▓   ▓     ▓      |==================================|   ▓      ▓      |
|   ▓▓▓    ▓▓▓             | Birth Date (YYYY/MM/DD): ____/__/__ |  ▓▓▓           |
|                          | Life Expectancy (Years): __      |                |
|--------------------------|                                  |-----------------|
|                          | [Enter] Confirm | [Esc] Cancel   |                 |
|   HOUR[18/24] HR  | |▓▓▓▓+----------------------------------+▓▓▓▓▓▓▓▓▓▓▓▓██░░| 75% |
| MINUTE[31/60] MIN | |▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█░░░░░░░░░░░░░░░░░░░░░░| 52% |
| SECOND[52/60] SEC | >================================================>█          | 87% |
|------------------------------------------------------------------------------|
|    DAY[21/31] DAY | |▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓██░░░░░░░░░░░░░░░░░░░░░░░░| 68% |
|  MONTH[11/12] MTH | |▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█░░░░░░░░░░| 92% |
|   LIFE[35/80] YRS  | |▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█░░░░░░░░░░░░░░░░░░░| 44% |
|                                                                              |
| [E]dit | [S]witch              > PERSPECTIVE :: [ ELAPSED ]                 |
+------------------------------------------------------------------------------+
```

### 2.4. 命令行交互 (CLI Interaction)

本应用的核心交互逻辑围绕数据的初始化、查看和修改，所有操作均在单一界面内通过浮窗完成。

#### 2.4.1. 启动与数据初始化 (Launch & Data Initialization)

应用启动时，会首先检查本地存储 (`localStorage`) 中是否存在用户数据。

*   **场景一：首次进入 (无本地数据)**
    1.  系统检测到 `localStorage` 中缺少数据。
    2.  主监控界面会先加载，然后一个 **设置浮窗 (Setup Overlay)** 会自动叠加在屏幕中央。
    3.  浮窗会提示用户输入 `出生日期` 和 `预期寿命`，并提供 `[Enter]` 确认和 `[Esc]` 取消的快捷键。
    4.  用户输入完成后，按 `Enter` 确认。
    5.  输入的数据被验证并保存到 `localStorage`，浮窗关闭。
    6.  主监控界面根据新数据进行渲染。

*   **场景二：返回用户 (有本地数据)**
    1.  系统检测到 `localStorage` 中存在有效数据。
    2.  应用将直接读取这些数据，并立即渲染完整的主监控界面。

#### 2.4.2. 编辑现有数据 (Editing Existing Data)

在主监控界面运行时，用户可以随时修改已存储的数据。

*   **触发:** 用户通过按 `E` 键 (`E`dit) 来进入编辑模式。
*   **响应:**
    1.  一个 **编辑浮窗 (Edit Overlay)** 会叠加在当前主监控界面的中央。
    2.  浮窗会预先填入当前存储的 `birthDate` 和 `lifeExpectancy`。
    3.  用户可以修改这些值，然后按 `Enter` 确认，或按 `Esc` 取消。
    4.  确认后，新的数据将覆盖 `localStorage` 中的旧数据，浮窗关闭。
    5.  主监控界面根据新数据重新计算和渲染所有视图。

#### 2.4.3. 视角切换 (Perspective Switching)

*   **触发:** 用户通过按 `S` 键 (`S`witch) 或 `空格键` 来切换视角。
*   **响应:**
    1.  系统状态 `perspective` 在 `'ELAPSED'` 和 `'REMAINING'` 之间切换。
    2.  整个 CLI 界面立即清屏并重绘以反映新的状态。
*   **动画:** 切换过程为瞬时完成，无任何过渡动画，以保持其作为两个独立、完整画面的哲学感。

### 2.5. 终端渲染环境 (Terminal Rendering Environment)

*   **字体:** 必须在支持**等宽字体 (Monospaced Font)** 的终端环境中运行，以确保布局的对齐和完整性。
*   **尺寸:** 推荐终端窗口尺寸至少为 80 列 x 25行，以完整显示整个界面而无需换行或滚动。
*   **颜色:** 设计为单色，不依赖特定的颜色主题，以保证在所有终端下的兼容性。

## 3. 技术规格

### 3.1. 状态管理 (State Management)

需要维护以下核心状态：

*   `perspective`: `'ELAPSED' | 'REMAINING'` - 当前视角模式，默认为 `'ELAPSED'`。
*   `birthDate`: `Date` - 用户出生日期的 Date 对象。
*   `lifeExpectancy`: `number` - 预期寿命（年）。
*   `now`: `Date` - 当前时间，需要定期更新（例如每秒）以驱动界面刷新。

### 3.2. 核心逻辑

*   **`togglePerspective()` 函数:**
    *   读取当前 `perspective` 状态。
    *   将其设置为相反的值。
    *   触发UI重绘。

*   **`renderProgressBar(current, total, perspective)` 函数:**
    *   根据 `perspective` 模式，计算百分比和进度条的字符（`▓`, `░`, `█`）分布。
    *   返回最终的字符串以供显示。

### 3.3. 开发技术栈 (Development Technology Stack)

*   **框架 (Framework):** Next.js
*   **包管理器 (Package Manager):** pnpm
*   **部署 (Deployment):** Vercel
    
### 3.4. 开发实施建议 (Implementation Suggestions)

为了将上述设计精确地转化为一个高性能的 Web 应用，建议在开发过程中考虑以下几点：

*   **1. 核心渲染引擎 (Core Rendering Engine)**
    *   **建议:** 创建一个独立的、纯粹的渲染函数（或一组函数），例如 `render(state) => string[]`。
    *   **理由:** 此函数的核心职责是接收完整的应用状态（包括 `now`, `perspective`, `birthDate` 等），并返回一个代表屏幕每一行的字符串数组。将渲染逻辑与 React 组件的生命周期和状态更新逻辑分离，可以使代码更清晰、更易于测试和维护。所有关于字符定位、填充和布局的计算都应在此引擎内完成。

*   **2. 状态管理与副作用 (State Management & Side Effects)**
    *   **建议:** 使用一个自定义 React Hook (例如 `useLifeMonitorState`) 来封装所有核心状态和相关的副作用。
    *   **理由:** 这个 Hook 将负责：
        *   使用 `useState` 或 `useReducer` 管理 `perspective`, `birthDate`, `lifeExpectancy` 等状态。
        *   通过 `useEffect` 设置一个 `setInterval` 计时器，以固定频率（如每 100 毫秒）更新 `now` 状态，从而驱动界面刷新。
        *   同样在 `useEffect` 中处理与 `localStorage` 的数据同步（读取初始数据和保存用户修改）。
        *   返回一个包含所有状态和更新函数的对象，供主界面组件使用。

*   **3. 浮窗的实现 (Overlay Implementation)**
    *   **挑战:** 在 ASCII 界面上实现“浮窗”与传统的 HTML/CSS `z-index` 不同。它需要在字符级别上进行“绘制”。
    *   **建议:** 核心渲染引擎 `render(state)` 应接受一个可选的 `overlay` 参数，例如 `render(state, overlay?)`。当 `overlay` 对象存在时（例如，当用户按 `E` 进入编辑模式），渲染引擎会在生成主界面后，根据浮窗的坐标和尺寸，将浮窗的字符内容“画”在主界面对应的字符位置上，覆盖掉原有的字符。

*   **4. 样式与字体 (Styling & Font)**
    *   **关键:** 必须确保渲染容器使用等宽字体，并且保留所有的空格和换行符。
    *   **建议:** 在 Next.js 中，用于显示 ASCII 艺术的组件（例如一个 `<pre>` 标签）应应用以下 CSS 样式：
        ```css
        .ascii-container {
          font-family: 'Menlo', 'Monaco', 'Courier New', monospace;
          white-space: pre;
          line-height: 1.1; /* 根据字体微调，确保行间距紧凑 */
        }
        ```

*   **5. 性能优化 (Performance Optimization)**
    *   **挑战:** 频繁更新 `now` 状态会导致 React 组件频繁重渲染。
    *   **建议:**
        *   **`React.memo`:** 将界面的静态部分（如边框、标题）或变化不频繁的部分封装成独立的子组件，并使用 `React.memo` 进行包装，避免不必要的重绘。
        *   **`useMemo`:** 对于复杂的计算（如生成 ASCII 时钟的某一部分），可以使用 `useMemo` 来缓存计算结果，仅在依赖项（如当前的小时或分钟数）变化时才重新计算。

*   **6. 交互处理 (Interaction Handling)**
    *   **建议:** 在主应用组件的 `useEffect` 中添加一个全局的 `keydown` 事件监听器。
    *   **理由:** 这个监听器将捕获用户的按键（如 `E`, `S`, `Space`, `Enter`, `Esc`），并调用从自定义 Hook 中获取的状态更新函数来改变应用状态（例如切换 `perspective` 或弹出编辑浮窗）。记得在组件卸载时移除监听器以防止内存泄漏。

## 4. 设计哲学

此设计的核心是将一个工具升华为一个概念艺术品。开发过程中应始终围绕以下哲学原则：

1.  **锚点的转换 (Anchor Shift):** `BORN` vs. `EOL`。这不只是标签的改变，而是参考系的根本切换。它让用户在"已逝"和"未至"的两个宇宙间穿梭。
2.  **数据的镜像 (Data Mirroring):** `ELAPSED` 和 `REMAINING` 在数学上必须是完美的互补关系。这种严谨性是产品逻辑自洽的基石，赋予了诗意以真理的力量。
3.  **叙事的完整性 (Narrative Completion):** 产品必须同时呈现"来路"与"归途"，构成一个封闭、完整的循环。它不提供答案，而是通过对立的视角引发用户对自身存在的思考。

该设计在概念上是完整且自洽的，不应再添加或删减核心功能，以保持其纯粹性和艺术完整性。